(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{333:function(e,t,n){e.exports=n(598)},339:function(e,t,n){},349:function(e,t){},598:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(59),c=n.n(i),l=(n(338),n(339),n(32)),s=n(33),r=n(35),d=n(34),h=n(16),u=n(36),p=n(62),m=n(137),f=n.n(m);var g=function(e){var t=e.photosToDownload,n=t.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).length,o=function(e){return e.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return e.downloaded}))}(t);return a.a.createElement("div",{className:"downloadStatus"},a.a.createElement(f.a,null),a.a.createElement("h3",null,"Downloading...(please wait)"),a.a.createElement("h4",null,o.length," / ",n," photos"))},b=n(304),w=n.n(b),v=n(20),k=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(r.a)(this,Object(d.a)(t).call(this,e))).state={open:!1},n.displayImage=n.displayImage.bind(Object(h.a)(n)),n.close=n.close.bind(Object(h.a)(n)),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"open",value:function(e){e.preventDefault(),this.setState({open:!0})}},{key:"close",value:function(e){e.preventDefault(),this.setState({open:!1})}},{key:"previewImage",value:function(e){e.preventDefault()}},{key:"displayImage",value:function(){}},{key:"render",value:function(){var e=this.props.images[this.props.images.length-1],t=this.state.open;return this.handleClick=this.props.onClick,a.a.createElement("div",{id:this.props.id,className:"photo",onChange:this.props.handleChange},a.a.createElement("label",null,this.props.name?this.props.name:"*Photo without title*"),a.a.createElement("input",{type:"checkbox",checked:this.props.checked}),a.a.createElement(v.b,{className:"photoButton",onClick:this.open.bind(this)},"Preview"),a.a.createElement(v.d,{size:"small",open:t,onClose:this.close},a.a.createElement(v.d.Header,null,this.props.name),a.a.createElement(v.d.Content,{style:{textAlign:"center"}},a.a.createElement("img",{src:e.source,alt:this.props.name,width:e.width,height:e.height,onClick:this.displayImage})),a.a.createElement(v.d.Actions,null,a.a.createElement(v.b,{negative:!0,icon:"remove",labelPosition:"right",content:"Close",onClick:this.close}))))}}]),t}(a.a.Component),C=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(r.a)(this,Object(d.a)(t).call(this,e))).state={collapsed:!1,active:!1},n.toggleCollapse=n.toggleCollapse.bind(Object(h.a)(n)),n.toggleActive=n.toggleActive.bind(Object(h.a)(n)),n.handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"toggleCollapse",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"toggleActive",value:function(){this.setState({active:!this.state.active})}},{key:"handleChange",value:function(e){this.props.onAlbumChange(e,this.props.index)}},{key:"render",value:function(){var e=this,t=this.props.photos.map((function(t,n){return a.a.createElement(k,{key:n,id:"photo".concat(e.props.index,"-").concat(n),name:t.name,images:t.images,checked:t.checked,handleChange:e.props.onPhotoChange})})),n=this.state.active;return a.a.createElement("div",{className:"album"},a.a.createElement(v.a,{fluid:!0},a.a.createElement(v.a.Title,{active:n,index:0,onClick:this.toggleActive},a.a.createElement(v.c,{name:"dropdown"}),this.props.name),a.a.createElement("input",{type:"checkbox",checked:this.props.checked,onChange:this.handleChange,id:"album"+this.props.index}),a.a.createElement(v.a.Content,{active:n},a.a.createElement("div",{className:"collapse photoContainer",id:"photoContainer".concat(this.props.index)},t))))}}]),t}(a.a.Component),j=(a.a.Component,function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(r.a)(this,Object(d.a)(t).call(this,e))).getZipFile=function(e){var t=new w.a;e.forEach((function(e){var n=t.folder(e.name);e.photos.forEach((function(e){return n.file(e.name,e.blob)}))}));n.state.downloadInfo;return t.generateAsync({type:"blob"}).then((function(e){return n.setState({downloadInfo:{downloading:!1,downloadedContentBlob:e,photosToDownload:n.state.photosToDownload}}),Promise.resolve(e)}))},n.downloadImagesAndGetZipFile=function(){return n.downloadImages().then(n.getZipFile).catch(console.error)},n.closeModal=function(){return n.setState({openModal:!1})},n.initialUserAlbums=null,n.state={loaded:!1,openModal:!1,downloadInfo:{downloading:!1,downloadedContentBlob:null,photosToDownload:null,downloadingAlbumIndex:null,downloadingPhotoIndex:null}},n.handleAlbumChange=n.handleAlbumChange.bind(Object(h.a)(n)),n.handlePhotoChange=n.handlePhotoChange.bind(Object(h.a)(n)),n.getZipFile=n.getZipFile.bind(Object(h.a)(n)),n.downloadImages=n.downloadImages.bind(Object(h.a)(n)),n.downloadImagesAndGetZipFile=n.downloadImagesAndGetZipFile.bind(Object(h.a)(n)),n.downloadImagesAndSaveZipFile=n.downloadImagesAndSaveZipFile.bind(Object(h.a)(n)),n.assignNewCheckedPhotosToArray=n.assignNewCheckedPhotosToArray.bind(Object(h.a)(n)),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.createInitialState().then((function(t){e.initialUserAlbums=t,e.setState({userAlbums:t,loaded:!0})})).catch(console.error)}},{key:"assignNewCheckedPhotosToArray",value:function(e,t){return e.map((function(e,n){return Object.assign(e,{checked:t[n]})}))}},{key:"createInitialState",value:function(){var e=this.props,t=e.userId,n=e.accessToken,o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost/getAlbums?userID=".concat(t,"&access_token=").concat(n):"https://easy-photo-downloader.herokuapp.com/getAlbums?userID=".concat(t,"&access_token=").concat(n);return new Promise((function(e,t){fetch(o).then((function(e){return e.json()})).then((function(t){return e(t.map((function(e,t){var n=e.photos.map((function(e){return Object.assign(e,{checked:!1})}));return{name:e.name,index:t,checked:!1,photos:n}})))})).catch(t)}))}},{key:"handleAlbumChange",value:function(e,t){var n=this.state,o=n.userAlbums,a=n.downloadInfo,i=o[t].photos,c=o.map((function(e,n){return t===n?Object(p.a)({},e,{photos:i.map((function(t){return Object(p.a)({},t,{checked:!e.checked})})),checked:!e.checked}):e})),l=Object(p.a)({},a,{downloadedContentBlob:null});this.setState({userAlbums:c,downloadInfo:l})}},{key:"handlePhotoChange",value:function(e){var t=e.target.parentNode,n=parseInt(t.id.match(/(\d)*-/)[0].slice(0,-1),10),o=parseInt(t.id.match(/-(\d)*/)[0].slice(1),10),a=this.state,i=a.userAlbums[n].photos,c=i.map((function(e){return e.checked})).map((function(e,t){return t===o!==e})),l=this.assignNewCheckedPhotosToArray(i,c),s=a.userAlbums.map((function(e,t){var o;if(t===n){var a=-1!==c.indexOf(!0);o=Object(p.a)({},e,{checked:a,photos:l})}else o=e;return o})),r=this.state.downloadInfo,d=Object(p.a)({},r,{downloadedContentBlob:null});this.setState({userAlbums:s,downloadInfo:d})}},{key:"fetchPhoto",value:function(e){return new Promise((function(t,n){fetch(e.images[0].source).then((function(e){return e.blob()})).then((function(n){return t({name:"".concat(e.id,".jpg"),blob:n})})).catch(n)}))}},{key:"filterCheckedPhotos",value:function(e){var t=this;return e.filter((function(e){return e.checked})).map((function(e){var n={name:e.name,index:e.index,checked:e.checked};return n.photos=e.photos.map((function(e){return e.checked})).map((function(n,o){if(n){var a=t.state.userAlbums[e.index].photos[o];return Object.assign(a,{downloaded:!1})}return null})).filter((function(e){return e?e.checked:null})),n}))}},{key:"markPhotoAsDownloaded",value:function(e,t,n){return n.map((function(n,o){return t===o?Object.assign(n,{photos:n.photos.map((function(t,n){return e===n?Object.assign(t,{downloaded:!0}):t}))}):n}))}},{key:"downloadImages",value:function(){var e=this,t=this.state.userAlbums,n=this.filterCheckedPhotos(t),o=[],a=this.state.downloadInfo;return 0===n.length?(this.setState({downloadInfo:Object(p.a)({},a,{downloading:!1})}),Promise.reject("No photos selected")):new Promise((function(t){e.setState({downloadInfo:Object(p.a)({},a,{downloading:!0,photosToDownload:n})},(function(){n.forEach((function(t,n){o.push(new Promise((function(o,a){Promise.all(t.photos.map((function(t,o){return new Promise((function(a,i){e.fetchPhoto(t).then((function(t){var i=e.markPhotoAsDownloaded(o,n,e.state.downloadInfo.photosToDownload),c=Object.assign(e.state.downloadInfo,{photosToDownload:i});e.setState({downloadInfo:c}),a(t)})).catch(i)}))}))).then((function(e){o({name:t.name,photos:e})})).catch(a)})))})),t(Promise.all(o))}))}))}},{key:"downloadImagesAndSaveZipFile",value:function(){var e=this;this.downloadImages().then(this.getZipFile).then((function(t){e.setState({downloadInfo:{downloading:!1,downloadedContentBlob:t,photosToDownload:e.state.photosToDownload}});var n=document.createElement("a"),o=URL.createObjectURL(t);n.style.display="none",n.href=o,n.download="photos.zip",document.body.appendChild(n),n.click()})).catch((function(t){e.setState({downloadInfo:{downloading:!1,photosToDownload:e.state.photosToDownload}}),console.error(t)}))}},{key:"getDownloadedPhotos",value:function(){return this.state.downloadInfo.photosToDownload.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return e.downloaded}))}},{key:"render",value:function(){var e=this,t=this.state.loaded?this.state.userAlbums.map((function(t,n){return a.a.createElement(C,{key:n,index:n,name:t.name,photos:t.photos,checked:t.checked,onAlbumChange:e.handleAlbumChange,onPhotoChange:e.handlePhotoChange})})):null,n=this.state,o=n.downloadInfo,i=n.openModal;o.downloadedContentBlob;return a.a.createElement("div",null,this.state.loaded?a.a.createElement("div",null,o.downloading?a.a.createElement(g,{photosToDownload:o.photosToDownload}):a.a.createElement(a.a.Fragment,null,a.a.createElement("form",{id:"albumList"},t),a.a.createElement(v.b,{fluid:!0,onClick:this.downloadImagesAndSaveZipFile,className:"downloadButton"},"Download Photos!"))):a.a.createElement("div",null,a.a.createElement(f.a,null),a.a.createElement("div",{style:{textAlign:"center"}},"Loading...")),a.a.createElement(v.d,{size:"small",open:i,onClose:this.closeModal},a.a.createElement(v.d.Header,null,"Photos uploaded to Google Drive!"),a.a.createElement(v.d.Actions,null,a.a.createElement(v.b,{negative:!0,icon:"remove",labelPosition:"right",content:"Close",onClick:this.closeModal}))))}}]),t}(a.a.Component)),E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(r.a)(this,Object(d.a)(t).call(this,e))).state={rotate:!1},n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleClick",value:function(){this.setState({rotate:!this.state.rotate})}},{key:"render",value:function(){return a.a.createElement("div",{id:"loginPage"},a.a.createElement(v.b,{color:"facebook",onClick:this.props.handleLogin},a.a.createElement(v.c,{name:"facebook"})," Continue with Facebook"))}}]),t}(a.a.Component),y=function(e){function t(e){var n;Object(l.a)(this,t),n=Object(r.a)(this,Object(d.a)(t).call(this,e)),"gcrispino.github.io"===window.location.hostname&&"http:"===window.location.protocol&&(window.location.protocol="https:");return n.state={appId:"1684103011832056",loggedIn:!1,sdkLoaded:!0},n.statusChangeCallback=n.statusChangeCallback.bind(Object(h.a)(n)),n}return Object(u.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function(t,n,o){var a,i=t.getElementsByTagName(n)[0];t.getElementById(o)||((a=t.createElement(n)).id=o,a.src="//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v6.0&appId=".concat(e.state.appId),i.parentNode.insertBefore(a,i),a.addEventListener("load",(function(){e.setState({sdkLoaded:!0,FB:window.FB})})))}(document,"script","facebook-jssdk")}},{key:"statusChangeCallback",value:function(e){if(console.log("statuschange"),e.authResponse){var t=e.authResponse.userID,n=e.authResponse.accessToken;console.log("connected!"),console.log(t,n),this.setState({loggedIn:!0,userId:t,accessToken:n})}else console.log("User cancelled login or did not fully authorize.")}},{key:"handleLogin",value:function(){window.FB.login(this.statusChangeCallback,{scope:"user_photos"})}},{key:"render",value:function(){var e=this.state,t=e.userId,n=e.accessToken;return this.state.sdkLoaded?this.state.loggedIn?a.a.createElement(j,{userId:t,accessToken:n}):a.a.createElement(E,{handleLogin:this.handleLogin.bind(this)}):a.a.createElement("div",null,"Loading FB info...")}}]),t}(a.a.Component),I=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function O(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}console.log(y),c.a.render(a.a.createElement(y,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/EasyPhotoDownloader",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/EasyPhotoDownloader","/service-worker.js");I?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):O(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):O(e)}))}}()}},[[333,1,2]]]);
//# sourceMappingURL=main.2af8eef0.chunk.js.map