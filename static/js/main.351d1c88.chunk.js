(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{333:function(e,t,n){e.exports=n(605)},339:function(e,t,n){},340:function(e,t,n){"use strict";n.r(t),function(e){var t=n(61),o=n(31),a=n(32),i=n(35),c=n(33),s=n(16),l=n(34),r=n(0),d=n(341),u=n(347),h=n(211),p=n(98),m=p.Button,f=p.Modal,g=n(601),b=(n(603),function(e){function n(e){var t;return Object(o.a)(this,n),(t=Object(i.a)(this,Object(c.a)(n).call(this,e))).getZipFile=function(e){var n=new u;e.forEach((function(e){var t=n.folder(e.name);e.photos.forEach((function(e){return t.file(e.name,e.blob)}))}));t.state.downloadInfo;return n.generateAsync({type:"blob"}).then((function(e){return t.setState({downloadInfo:{downloading:!1,downloadedContentBlob:e,photosToDownload:t.state.photosToDownload}}),Promise.resolve(e)}))},t.downloadImagesAndGetZipFile=function(){return t.downloadImages().then(t.getZipFile).catch(console.error)},t.closeModal=function(){return t.setState({openModal:!1})},t.initialUserAlbums=null,t.state={loaded:!1,openModal:!1,downloadInfo:{downloading:!1,downloadedContentBlob:null,photosToDownload:null,downloadingAlbumIndex:null,downloadingPhotoIndex:null}},t.handleAlbumChange=t.handleAlbumChange.bind(Object(s.a)(t)),t.handlePhotoChange=t.handlePhotoChange.bind(Object(s.a)(t)),t.getZipFile=t.getZipFile.bind(Object(s.a)(t)),t.downloadImages=t.downloadImages.bind(Object(s.a)(t)),t.downloadImagesAndGetZipFile=t.downloadImagesAndGetZipFile.bind(Object(s.a)(t)),t.downloadImagesAndSaveZipFile=t.downloadImagesAndSaveZipFile.bind(Object(s.a)(t)),t.assignNewCheckedPhotosToArray=t.assignNewCheckedPhotosToArray.bind(Object(s.a)(t)),t}return Object(l.a)(n,e),Object(a.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.createInitialState().then((function(t){e.initialUserAlbums=t,e.setState({userAlbums:t,loaded:!0})})).catch(console.error)}},{key:"assignNewCheckedPhotosToArray",value:function(e,t){return e.map((function(e,n){return Object.assign(e,{checked:t[n]})}))}},{key:"createInitialState",value:function(){var e=this.props,t=e.userId,n=e.accessToken,o="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost/getAlbums?userID=".concat(t,"&access_token=").concat(n):"https://easy-photo-downloader.herokuapp.com/getAlbums?userID=".concat(t,"&access_token=").concat(n);return new Promise((function(e,t){fetch(o).then((function(e){return e.json()})).then((function(t){return e(t.map((function(e,t){var n=e.photos.map((function(e){return Object.assign(e,{checked:!1})}));return{name:e.name,index:t,checked:!1,photos:n}})))})).catch(t)}))}},{key:"handleAlbumChange",value:function(e,n){var o=this.state,a=o.userAlbums,i=o.downloadInfo,c=a[n].photos,s=a.map((function(e,o){return n===o?Object(t.a)({},e,{photos:c.map((function(n){return Object(t.a)({},n,{checked:!e.checked})})),checked:!e.checked}):e})),l=Object(t.a)({},i,{downloadedContentBlob:null});this.setState({userAlbums:s,downloadInfo:l})}},{key:"handlePhotoChange",value:function(e){var n=e.target.parentNode,o=parseInt(n.id.match(/(\d)*-/)[0].slice(0,-1),10),a=parseInt(n.id.match(/-(\d)*/)[0].slice(1),10),i=this.state,c=i.userAlbums[o].photos,s=c.map((function(e){return e.checked})).map((function(e,t){return t===a!==e})),l=this.assignNewCheckedPhotosToArray(c,s),r=i.userAlbums.map((function(e,n){var a;if(n===o){var i=-1!==s.indexOf(!0);a=Object(t.a)({},e,{checked:i,photos:l})}else a=e;return a})),d=this.state.downloadInfo,u=Object(t.a)({},d,{downloadedContentBlob:null});this.setState({userAlbums:r,downloadInfo:u})}},{key:"fetchPhoto",value:function(e){return new Promise((function(t,n){fetch(e.images[0].source).then((function(e){return e.blob()})).then((function(n){return t({name:"".concat(e.id,".jpg"),blob:n})})).catch(n)}))}},{key:"filterCheckedPhotos",value:function(e){var t=this;return e.filter((function(e){return e.checked})).map((function(e){var n={name:e.name,index:e.index,checked:e.checked};return n.photos=e.photos.map((function(e){return e.checked})).map((function(n,o){if(n){var a=t.state.userAlbums[e.index].photos[o];return Object.assign(a,{downloaded:!1})}return null})).filter((function(e){return e?e.checked:null})),n}))}},{key:"markPhotoAsDownloaded",value:function(e,t,n){return n.map((function(n,o){return t===o?Object.assign(n,{photos:n.photos.map((function(t,n){return e===n?Object.assign(t,{downloaded:!0}):t}))}):n}))}},{key:"downloadImages",value:function(){var e=this,n=this.state.userAlbums,o=this.filterCheckedPhotos(n),a=[],i=this.state.downloadInfo;return 0===o.length?(this.setState({downloadInfo:Object(t.a)({},i,{downloading:!1})}),Promise.reject("No photos selected")):new Promise((function(n){e.setState({downloadInfo:Object(t.a)({},i,{downloading:!0,photosToDownload:o})},(function(){o.forEach((function(t,n){a.push(new Promise((function(o,a){Promise.all(t.photos.map((function(t,o){return new Promise((function(a,i){e.fetchPhoto(t).then((function(t){var i=e.markPhotoAsDownloaded(o,n,e.state.downloadInfo.photosToDownload),c=Object.assign(e.state.downloadInfo,{photosToDownload:i});e.setState({downloadInfo:c}),a(t)})).catch(i)}))}))).then((function(e){o({name:t.name,photos:e})})).catch(a)})))})),n(Promise.all(a))}))}))}},{key:"downloadImagesAndSaveZipFile",value:function(){var e=this;this.downloadImages().then(this.getZipFile).then((function(t){e.setState({downloadInfo:{downloading:!1,downloadedContentBlob:t,photosToDownload:e.state.photosToDownload}});var n=document.createElement("a"),o=URL.createObjectURL(t);n.style.display="none",n.href=o,n.download="photos.zip",document.body.appendChild(n),n.click()})).catch((function(t){e.setState({downloadInfo:{downloading:!1,photosToDownload:e.state.photosToDownload}}),console.error(t)}))}},{key:"getDownloadedPhotos",value:function(){return this.state.downloadInfo.photosToDownload.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return e.downloaded}))}},{key:"render",value:function(){var e=this,t=this.state.loaded?this.state.userAlbums.map((function(t,n){return r.createElement(g,{key:n,index:n,name:t.name,photos:t.photos,checked:t.checked,onAlbumChange:e.handleAlbumChange,onPhotoChange:e.handlePhotoChange})})):null,n=this.state,o=n.downloadInfo,a=n.openModal;o.downloadedContentBlob;return r.createElement("div",null,this.state.loaded?r.createElement("div",null,o.downloading?r.createElement(d,{photosToDownload:o.photosToDownload}):r.createElement(r.Fragment,null,r.createElement("form",{id:"albumList"},t),r.createElement(m,{fluid:!0,onClick:this.downloadImagesAndSaveZipFile,className:"downloadButton"},"Download Photos!"))):r.createElement("div",null,r.createElement(h,null),r.createElement("div",{style:{textAlign:"center"}},"Loading...")),r.createElement(f,{size:"small",open:a,onClose:this.closeModal},r.createElement(f.Header,null,"Photos uploaded to Google Drive!"),r.createElement(f.Actions,null,r.createElement(m,{negative:!0,icon:"remove",labelPosition:"right",content:"Close",onClick:this.closeModal}))))}}]),n}(r.Component));e.exports=b}.call(this,n(84)(e))},341:function(e,t,n){var o=n(0),a=n(211);e.exports=function(e){var t=e.photosToDownload,n=t.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).length,i=function(e){return e.map((function(e){return e.photos})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return e.downloaded}))}(t);return o.createElement("div",{className:"downloadStatus"},o.createElement(a,null),o.createElement("h3",null,"Downloading...(please wait)"),o.createElement("h4",null,i.length," / ",n," photos"))}},352:function(e,t){},601:function(e,t,n){"use strict";n.r(t),function(e){var t=n(31),o=n(32),a=n(35),i=n(33),c=n(16),s=n(34),l=n(0),r=n(602),d=n(98),u=d.Accordion,h=d.Icon,p=function(e){function n(e){var o;return Object(t.a)(this,n),(o=Object(a.a)(this,Object(i.a)(n).call(this,e))).state={collapsed:!1,active:!1},o.toggleCollapse=o.toggleCollapse.bind(Object(c.a)(o)),o.toggleActive=o.toggleActive.bind(Object(c.a)(o)),o.handleChange=o.handleChange.bind(Object(c.a)(o)),o}return Object(s.a)(n,e),Object(o.a)(n,[{key:"toggleCollapse",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"toggleActive",value:function(){this.setState({active:!this.state.active})}},{key:"handleChange",value:function(e){this.props.onAlbumChange(e,this.props.index)}},{key:"render",value:function(){var e=this,t=this.props.photos.map((function(t,n){return l.createElement(r,{key:n,id:"photo".concat(e.props.index,"-").concat(n),name:t.name,images:t.images,checked:t.checked,handleChange:e.props.onPhotoChange})})),n=this.state.active;return l.createElement("div",{className:"album"},l.createElement(u,{fluid:!0},l.createElement(u.Title,{active:n,index:0,onClick:this.toggleActive},l.createElement(h,{name:"dropdown"}),this.props.name),l.createElement("input",{type:"checkbox",checked:this.props.checked,onChange:this.handleChange,id:"album"+this.props.index}),l.createElement(u.Content,{active:n},l.createElement("div",{className:"collapse photoContainer",id:"photoContainer".concat(this.props.index)},t))))}}]),n}(l.Component);e.exports=p}.call(this,n(84)(e))},602:function(e,t,n){"use strict";n.r(t),function(e){var t=n(31),o=n(32),a=n(35),i=n(33),c=n(16),s=n(34),l=n(0),r=n(98),d=r.Button,u=r.Modal,h=function(e){function n(e){var o;return Object(t.a)(this,n),(o=Object(a.a)(this,Object(i.a)(n).call(this,e))).state={open:!1},o.displayImage=o.displayImage.bind(Object(c.a)(o)),o.close=o.close.bind(Object(c.a)(o)),o}return Object(s.a)(n,e),Object(o.a)(n,[{key:"open",value:function(e){e.preventDefault(),this.setState({open:!0})}},{key:"close",value:function(e){e.preventDefault(),this.setState({open:!1})}},{key:"previewImage",value:function(e){e.preventDefault()}},{key:"displayImage",value:function(){}},{key:"render",value:function(){var e=this.props.images[this.props.images.length-1],t=this.state.open;return this.handleClick=this.props.onClick,l.createElement("div",{id:this.props.id,className:"photo",onChange:this.props.handleChange},l.createElement("label",null,this.props.name?this.props.name:"*Photo without title*"),l.createElement("input",{type:"checkbox",checked:this.props.checked}),l.createElement(d,{className:"photoButton",onClick:this.open.bind(this)},"Preview"),l.createElement(u,{size:"small",open:t,onClose:this.close},l.createElement(u.Header,null,this.props.name),l.createElement(u.Content,{style:{textAlign:"center"}},l.createElement("img",{src:e.source,alt:this.props.name,width:e.width,height:e.height,onClick:this.displayImage})),l.createElement(u.Actions,null,l.createElement(d,{negative:!0,icon:"remove",labelPosition:"right",content:"Close",onClick:this.close}))))}}]),n}(l.Component);e.exports=h}.call(this,n(84)(e))},603:function(e,t,n){"use strict";n.r(t),function(e){var t=n(31),o=n(32),a=n(35),i=n(33),c=n(16),s=n(34),l=n(0),r=n(98).Button,d=function(e){function n(e){var o;return Object(t.a)(this,n),(o=Object(a.a)(this,Object(i.a)(n).call(this,e))).createFile=function(e){console.log("createFile!!! -> ",e);var t="-------314159265358979323846",n="\r\n--"+t+"\r\n",a=o.state.gapi,i=new FileReader;return i.readAsBinaryString(e),new Promise((function(o){i.onload=function(c){var s=e.type||"application/octet-stream",l={title:"photos.zip",mimeType:s},r=btoa(i.result),d=n+"Content-Type: application/json\r\n\r\n"+JSON.stringify(l)+n+"Content-Type: "+s+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+r+"\r\n---------314159265358979323846--";a.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+t+'"'},body:d}).execute(o)}}))},o.handleClientLoad=function(){o.setState({gapi:window.gapi},(function(){this.state.gapi.load("client:auth2",this.initClient)}))},o.initClient=function(){var e=Object(c.a)(o),t=o.state.gapi;t.client.init({apiKey:e.API_KEY,clientId:e.CLIENT_ID,discoveryDocs:e.DISCOVERY_DOCS,scope:e.SCOPES}).then((function(){t.auth2.getAuthInstance().isSignedIn.listen(this.handleSigninStatusChange),e.setState({signedIn:t.auth2.getAuthInstance().isSignedIn.get()},(function(){console.log("mudou: ",e.state)}))}))},o.handleSigninStatusChange=function(e){var t=Object(c.a)(o).createFile,n=o.state.content,a=o.setState.bind(Object(c.a)(o));n&&a({uploading:!0},(function(){t(n).then((function(){return a({uploading:!1})}))}))},o.handleClick=function(){var e=o.props,t=e.contentToUpload,n=e.onFinishUpload,a=Object(c.a)(o).createFile,i=(o.state.uploading,o.setState.bind(Object(c.a)(o)));i({downloading:!0}),t().then((function(e){i({downloading:!1});var t=o.state.gapi.auth2.getAuthInstance();t.isSignedIn?i({uploading:!0},(function(){a(e).then((function(){return i({uploading:!1,content:e},n)}))})):t.signIn()}))},o.CLIENT_ID="901501021165-u55km00bs3m29v0lf8g4knccj4oacmik.apps.googleusercontent.com",o.API_KEY="AIzaSyDVpcXLh35yrymzXOzfZdCMsRdUsacUYxA",o.DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],o.SCOPES="https://www.googleapis.com/auth/drive.file",o.state={signedIn:!1,signinIn:!1,content:void 0},o}return Object(s.a)(n,e),Object(o.a)(n,[{key:"componentWillMount",value:function(){var e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.onload=this.handleClientLoad,document.body.appendChild(e)}},{key:"render",value:function(){var e=this.state,t=e.downloading,n=e.uploading,o=this.props,a=o.displayWhenDownloading,i=o.hidden,c=o.disabled,s=i?"none":t?a?this.props.display:"none":this.props.display;return l.createElement(r,{fluid:!0,className:this.props.className,style:{display:s},disabled:c,loading:n,onClick:this.handleClick},"Save to Google Drive")}}]),n}(l.Component);e.exports=d}.call(this,n(84)(e))},604:function(e,t,n){"use strict";n.r(t),function(e){var t=n(31),o=n(32),a=n(35),i=n(33),c=n(34),s=n(0),l=n(98),r=l.Button,d=l.Icon,u=function(e){function n(e){var o;return Object(t.a)(this,n),(o=Object(a.a)(this,Object(i.a)(n).call(this,e))).state={rotate:!1},o}return Object(c.a)(n,e),Object(o.a)(n,[{key:"handleClick",value:function(){this.setState({rotate:!this.state.rotate})}},{key:"render",value:function(){return s.createElement("div",{id:"loginPage"},s.createElement(r,{color:"facebook",onClick:this.props.handleLogin},s.createElement(d,{name:"facebook"})," Continue with Facebook"))}}]),n}(s.Component);e.exports=u}.call(this,n(84)(e))},605:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),i=n(58),c=n.n(i),s=(n(338),n(339),n(31)),l=n(32),r=n(35),d=n(33),u=n(16),h=n(34),p=n(0),m=n(340),f=n(604),g=function(e){function t(e){var n;Object(s.a)(this,t),n=Object(r.a)(this,Object(d.a)(t).call(this,e)),"gcrispino.github.io"===window.location.hostname&&"http:"===window.location.protocol&&(window.location.protocol="https:");return n.state={appId:"1684103011832056",loggedIn:!1,sdkLoaded:!0},n.statusChangeCallback=n.statusChangeCallback.bind(Object(u.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function(t,n,o){var a,i=t.getElementsByTagName(n)[0];t.getElementById(o)||((a=t.createElement(n)).id=o,a.src="//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v6.0&appId=".concat(e.state.appId),i.parentNode.insertBefore(a,i),a.addEventListener("load",(function(){e.setState({sdkLoaded:!0,FB:window.FB})})))}(document,"script","facebook-jssdk")}},{key:"statusChangeCallback",value:function(e){if(console.log("statuschange"),e.authResponse){var t=e.authResponse.userID,n=e.authResponse.accessToken;console.log("connected!"),console.log(t,n),this.setState({loggedIn:!0,userId:t,accessToken:n})}else console.log("User cancelled login or did not fully authorize.")}},{key:"handleLogin",value:function(){window.FB.login(this.statusChangeCallback,{scope:"user_photos"})}},{key:"render",value:function(){var e=this.state,t=e.userId,n=e.accessToken;return this.state.sdkLoaded?this.state.loggedIn?p.createElement(m,{userId:t,accessToken:n}):p.createElement(f,{handleLogin:this.handleLogin.bind(this)}):p.createElement("div",null,"Loading FB info...")}}]),t}(p.Component),b=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function v(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(a.a.createElement(g,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/EasyPhotoDownloader",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/EasyPhotoDownloader","/service-worker.js");b?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):v(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):v(e)}))}}()}},[[333,1,2]]]);
//# sourceMappingURL=main.351d1c88.chunk.js.map